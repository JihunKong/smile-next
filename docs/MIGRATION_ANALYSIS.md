# Flask → Next.js 마이그레이션 분석

## 현재 상태

| 항목 | 상태 |
|------|------|
| 환경 | **개발/POC 단계** (Staging 아님) |
| 목적 | 기술 검증 및 아키텍처 설계 |
| 프로덕션 영향 | 없음 (별도 프로젝트) |

---

## 이점 (Benefits)

### 1. 보안 강화

| 항목 | Flask (현재) | Next.js (마이그레이션 후) |
|------|-------------|-------------------------|
| CSRF 보호 | **비활성화됨** | 내장 (Server Actions) |
| XSS 방어 | 수동 이스케이프 | React 자동 이스케이프 |
| SQL Injection | SQLAlchemy (안전) | Prisma 파라미터화 (안전) |
| 인증 | Flask-Login | NextAuth.js (JWT, OAuth) |
| 타입 검증 | 없음 | TypeScript + Zod |

**결론**: CSRF 문제를 근본적으로 해결하며, 전반적인 보안 수준 향상

### 2. 개발 생산성

| 항목 | Flask | Next.js |
|------|-------|---------|
| 타입 안전성 | Python (동적) | TypeScript (정적) |
| 에러 발견 시점 | 런타임 | 컴파일 타임 |
| API 문서화 | 수동 | 타입에서 자동 추론 |
| 프론트-백 통합 | 분리 (API 호출) | Server Components (직접 DB 접근) |
| Hot Reload | 느림 | 즉시 (Turbopack) |

### 3. 성능 최적화

| 항목 | Flask | Next.js |
|------|-------|---------|
| 렌더링 | 서버 (Jinja2) | RSC + Streaming |
| 번들 크기 | N/A | 자동 코드 스플리팅 |
| 캐싱 | 수동 구현 | 내장 캐시 레이어 |
| Edge 배포 | 불가 | 가능 (Vercel Edge) |

### 4. 유지보수성

```
Flask 현재 상태:
- 23,000+ 라인 (27 route blueprints)
- 98,000+ 라인 (82 Jinja2 templates)
- 테스트 커버리지: 0%
- 문서화: 부분적

Next.js 목표:
- 단일 코드베이스 (풀스택)
- 컴포넌트 기반 재사용
- 타입 문서화 자동
- 테스트 인프라 구축 예정
```

### 5. 인프라 단순화

```
현재 (Flask):
┌─────────────────────────────────────┐
│ PM2 → Gunicorn → Flask              │
│ + Celery Workers                     │
│ + Redis (Celery broker)              │
│ + PostgreSQL                         │
│ + Nginx (reverse proxy)              │
└─────────────────────────────────────┘
관리 포인트: 5+

마이그레이션 후 (Next.js):
┌─────────────────────────────────────┐
│ Next.js (App + API + Workers)        │
│ + Redis (Bull Queue)                 │
│ + PostgreSQL                         │
└─────────────────────────────────────┘
관리 포인트: 3
```

---

## 리스크 (Risks)

### 1. 기술적 리스크

| 리스크 | 영향도 | 완화 방안 |
|--------|--------|----------|
| 데이터 마이그레이션 실패 | 높음 | 단계별 마이그레이션, 롤백 스크립트 준비 |
| AI 서비스 호환성 | 낮음 | 동일 API (OpenAI/Claude Node SDK 검증 완료) |
| 기능 누락 | 중간 | 기능 매트릭스 작성 및 체크리스트 관리 |
| 성능 저하 | 낮음 | 벤치마크 테스트 후 배포 |

### 2. 운영 리스크

| 리스크 | 영향도 | 완화 방안 |
|--------|--------|----------|
| 서비스 중단 | 높음 | Blue-Green 배포, 점진적 전환 |
| 사용자 혼란 | 중간 | UI/UX 일관성 유지 |
| 버그 증가 | 중간 | QA 프로세스 강화, E2E 테스트 |

### 3. 일정 리스크

| 단계 | 예상 기간 | 불확실성 |
|------|----------|---------|
| Phase 1: Foundation | 1주 (완료) | 낮음 |
| Phase 2: AI Services | 1주 | 낮음 |
| Phase 3: Core Features | 2주 | 중간 |
| Phase 4: Advanced Features | 2주 | 중간 |
| Phase 5: QA/Deploy | 2주 | 높음 |
| **Total** | **8주** | 중간 |

### 4. 리소스 리스크

- 마이그레이션 기간 동안 기존 시스템 유지보수 필요
- 두 시스템 병행 운영 시 복잡도 증가
- 학습 곡선 (TypeScript, Next.js App Router)

---

## 권장 진행 방안

### Option A: 점진적 마이그레이션 (권장)

```
1단계: 인프라 구축 (현재)
   └── CI/CD, Staging, QA DB 세팅

2단계: 신규 기능만 Next.js
   └── 기존 Flask와 API Gateway로 연동

3단계: 점진적 기능 이전
   └── 사용량 낮은 기능부터 이전
   └── 기능별 검증 후 다음 진행

4단계: 완전 전환
   └── 모든 기능 이전 완료 후 Flask 폐기
```

**장점**: 리스크 최소화, 롤백 용이
**단점**: 기간 길어짐 (3-6개월)

### Option B: 빅뱅 마이그레이션

```
1단계: 전체 기능 개발 (8주)
2단계: QA 집중 테스트 (2주)
3단계: 데이터 마이그레이션 + 전환 (1일)
```

**장점**: 빠른 전환, 단일 코드베이스 즉시 확보
**단점**: 리스크 높음, 롤백 어려움

---

## 선행 조건 (pd님 언급)

마이그레이션 본격 진행 전 필요한 인프라:

| 항목 | 현재 상태 | 필요 작업 |
|------|----------|----------|
| Staging 환경 | 없음 | Railway 또는 별도 서버 구축 |
| QA DB | 없음 | 프로덕션 스키마 복제 + 테스트 데이터 |
| CI/CD | 없음 | GitHub Actions 파이프라인 구축 |
| E2E 테스트 | 없음 | Playwright 테스트 작성 |
| 모니터링 | 없음 | 에러 추적, 성능 모니터링 설정 |

---

## 다음 단계 제안

1. **즉시**: Staging 환경 구축 (Railway)
2. **1주 내**: CI/CD 파이프라인 설정
3. **2주 내**: QA DB + 기본 E2E 테스트
4. **이후**: pd님과 마이그레이션 일정 협의

---

## 요약

| 구분 | 내용 |
|------|------|
| **핵심 이점** | CSRF 근본 해결, 타입 안전성, 인프라 단순화 |
| **주요 리스크** | 데이터 마이그레이션, 기능 누락, 일정 지연 |
| **권장 방안** | 점진적 마이그레이션 (인프라 먼저 구축) |
| **예상 기간** | 점진적: 3-6개월 / 빅뱅: 10주 |
